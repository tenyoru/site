{{ with resources.Get "scss/main.scss" }}
  {{ $opts := dict
    "enableSourceMap" hugo.IsDevelopment
    "outputStyle" (cond hugo.IsDevelopment "expanded" "compressed")
    "targetPath" "css/main.css"
    "transpiler" "dartsass"
    "vars" site.Params.styles
    "includePaths" (slice "node_modules/bootstrap/scss")
  }}
  {{ with . | toCSS $opts }}
    {{ $shouldInline := and (hugo.IsProduction) (not hugo.IsServer) }}
    {{ if not $shouldInline }}
      <link rel="stylesheet" href="{{ .RelPermalink }}">
    {{ else }}
      {{ $min := . | minify }}
      {{ $asset := $min | fingerprint }}
      <style>{{ $asset.Content | safeCSS }}</style>
      <link rel="preload" href="{{ $asset.RelPermalink }}" as="style" integrity="{{ $asset.Data.Integrity }}" crossorigin="anonymous">
      <link rel="stylesheet" href="{{ $asset.RelPermalink }}" integrity="{{ $asset.Data.Integrity }}" crossorigin="anonymous" media="print" onload="this.media='all'">
      <noscript>
        <link rel="stylesheet" href="{{ $asset.RelPermalink }}" integrity="{{ $asset.Data.Integrity }}" crossorigin="anonymous">
      </noscript>
    {{ end }}
  {{ end }}
{{ end }}
