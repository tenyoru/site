{{ define "main" }}
<div class="section shell--narrow">
  <header class="section-header">
    <h1 class="section-header__title">{{ .Title }}</h1>
    {{ with .Content }}
    <p class="section-header__desc">{{ . | plainify }}</p>
    {{ end }}
  </header>

  {{- $showDrafts := or hugo.IsDevelopment .Site.BuildDrafts -}}
  {{ if not $showDrafts }}
    {{ with .Data.Terms.ByCount }}
      <ul class="tag-list">
        {{ range . }}
        <li class="tag-list__item">
          <a href="{{ .Page.RelPermalink }}" class="tag-list__link">
            <span class="tag-list__name">{{ .Term }}</span>
            <span class="tag-list__count">{{ .Count }}</span>
          </a>
        </li>
        {{ end }}
      </ul>
    {{ else }}
      <p class="post-empty">No tags found yet.</p>
    {{ end }}
  {{ else }}
    {{- $scratch := newScratch -}}
    {{- $scratch.Set "tagData" (slice) -}}
    {{- range .Site.RegularPages -}}
      {{- if or (not .Draft) $showDrafts -}}
        {{- with .Params.tags -}}
          {{- range . -}}
            {{- $tag := . -}}
            {{- $slug := urlize $tag -}}
            {{- $countKey := printf "count-%s" $slug -}}
            {{- $count := $scratch.Get $countKey | default 0 -}}
            {{- $scratch.Set $countKey (add $count 1) -}}
            {{- $scratch.SetInMap "tagNames" $slug $tag -}}
          {{- end -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}
    {{- $tagNames := $scratch.Get "tagNames" -}}
    {{- $tagData := slice -}}
    {{- range $slug, $name := $tagNames -}}
      {{- $countKey := printf "count-%s" $slug -}}
      {{- $count := $scratch.Get $countKey | default 0 -}}
      {{- $tagData = $tagData | append (dict "slug" $slug "name" $name "count" $count) -}}
    {{- end -}}
    {{- $sorted := sort $tagData "count" "desc" -}}
    {{ if gt (len $sorted) 0 }}
      <ul class="tag-list">
        {{ range $sorted }}
        <li class="tag-list__item">
          <a href="{{ (printf "/tags/%s" .slug) | relLangURL }}" class="tag-list__link">
            <span class="tag-list__name">{{ .name }}</span>
            <span class="tag-list__count">{{ .count }}</span>
          </a>
        </li>
        {{ end }}
      </ul>
    {{ else }}
      <p class="post-empty">No tags found yet.</p>
    {{ end }}
  {{ end }}
</div>
{{ end }}
